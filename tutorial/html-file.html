<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>D3 Page Template</title>
        <script src="https://d3js.org/d3.v5.js"></script>
        <style type="text/css">
            /* rect:hover {
                fill: orange;
            }
            rect {
                -moz-transition: all 0.25s;
                -o-transition: all 0.25s;
                -webkit-transition: all 0.25s;
                transition: all 0.25s;
            } */
            #tooltip {
                position: absolute;
                width: 200px;
                height: auto;
                padding: 10px;
                background-color: white;
                -webkit-border-radius: 10px;
                -moz-border-radius: 10px;
                border-radius: 10px;
                -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                pointer-events: none;
            }
            #tooltip.hidden {
                display: none;
            }
            #tooltip p {
                margin: 0;
                font-family: sans-serif;
                font-size: 16px;
                line-height: 20px;
            }
	    </style>
    </head>
	<body>
        <div id="tooltip" class="hidden">
            <p><strong>Important Label Heading</strong></p>
            <p><span id="value">100</span>%</p>
        </div>
        <p id="add">Click here to add a value.</p>
        <p id="remove">Click here to remove a value.</p>
		<script type="text/javascript">

			//Width and height
			var w = 600;
			var h = 250;
			
			var dataset = [ { key: 0, value: 5 },
                            { key: 1, value: 10 },
                            { key: 2, value: 13 },
                            { key: 3, value: 19 },
                            { key: 4, value: 21 },
                            { key: 5, value: 25 },
                            { key: 6, value: 22 },
                            { key: 7, value: 18 },
                            { key: 8, value: 15 },
                            { key: 9, value: 13 },
                            { key: 10, value: 11 },
                            { key: 11, value: 12 },
                            { key: 12, value: 15 },
                            { key: 13, value: 20 },
                            { key: 14, value: 18 },
                            { key: 15, value: 17 },
                            { key: 16, value: 16 },
                            { key: 17, value: 18 },
                            { key: 18, value: 23 },
                            { key: 19, value: 25 } ];
            
            var key = function(d) {
                return d.key;
            };

			var xScale = d3.scaleBand()
							.domain(d3.range(dataset.length))
							.rangeRound([0, w])
							.paddingInner(0.05);

			var yScale = d3.scaleLinear()
							.domain([0, d3.max(dataset, d => d.value)])
							.range([0, h]);
			
			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			//Create bars
			svg.selectAll("rect")
			   .data(dataset, key)
			   .enter()
			   .append("rect")
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return h - yScale(d.value);
			   })
			   .attr("width", xScale.bandwidth())
			   .attr("height", function(d) {
			   		return yScale(d.value);
			   })
			   .attr("fill", function(d) {
					return "rgb(0, 0, " + Math.round(d.value * 10) + ")";
               })
               .on("mouseover", function(d){
                    var thisRect= d3.select(this)
                        .attr("fill", "orange");
                    var xPos = parseFloat(thisRect.attr("x")) + xScale.bandwidth() / 2;
                    var yPos = parseFloat(thisRect.attr("y")) / 2 + h / 2;

                    d3.select("#tooltip")
                        .style("left", xPos + "px")
                        .style("top", yPos+ "px")
                        .select("#value")
                        .text(d.value);
                    d3.select("#tooltip").classed("hidden", false);
               })
               .on("mouseout", function(d) {
                    d3.select(this)
                        .transition("restoreBarColor")
                        .duration(250)
                        .attr("fill", function(d, i){
                            return "rgb(0, 0, " + Math.round(d.value * 10) + ")";
                        });
                    d3.select("#tooltip").classed("hidden", true);
               })
               .on("click", function(){
                   sortBars();
               });

			//Create labels
			// svg.selectAll("text")
		    //    .data(dataset, key)
	    	//    .enter()
            //    .append("text")
            //    .style("pointer-events", "none")
   			//    .text(function(d) {
			//    		return d.value;
			//     })
			//     .attr("text-anchor", "middle")
			//     .attr("x", function(d, i) {
			//    		return xScale(i) + xScale.bandwidth() / 2;
			//     })
            //     .attr("y", function(d) {
            //         if (d.value < 2) {
            //             return h - yScale(d.value) -3;
            //         } else {
            //             return h - yScale(d.value) + 14;
            //         }
            //     })
			//     .attr("font-family", "sans-serif")
			//     .attr("font-size", "11px")
			//     .attr("fill", function(d, i){
            //         if (d.value < 2 ) {
            //             return "black";
            //         } else {
            //             return "white";
            //         }
            //     });
            
            d3.selectAll("p")
               .on("click", function(){
                //dataset = [ 11, 12, 15, 20, 18, 17, 16, 18, 23, 25,
                //    5, 10, 13, 19, 21, 25, 22, 18, 15, 13 ];
                //var numValues = dataset.length; //Count original length of dataset
                //dataset = []; //Initialize empty array
                // for (var i = 0; i < numValues; i++) { //Loop numValues times
                //     var newNumber = Math.floor(Math.random() * 50); //New random integer (0-24)
                //     dataset.push(newNumber); //Add new number to array
                // }
                if(d3.select(this).attr("id") == "add"){
                    var newValue = Math.floor(Math.random() * d3.max(dataset, d => d.value));
                    var newKey =  dataset[dataset.length - 1].key + 1;                
                    dataset.push({
                        key: newKey,
                        value: newValue
                    });
                } else dataset.shift();

                xScale.domain(d3.range(dataset.length));
                yScale.domain([0, d3.max(dataset, d => d.value)]);

                var bars = svg.selectAll("rect")
                    .data(dataset, key);

                bars.enter()
                    .append("rect")
                    .attr("x", w)
			        .attr("y", function(d) {
			   		    return h - yScale(d.value);
			        })
			        .attr("width", xScale.bandwidth())
			        .attr("height", function(d) {
			   		    return yScale(d.value);
			        })
			        .attr("fill", function(d) {
    					return "rgb(0, 0, " + Math.round(d * 10) + ")";
                    })
                    .merge(bars)
                    .transition()
                    // .delay(function(d, i){
                    //     return i / dataset.length * 1000;
                    // })
                    .duration(500)
                    .ease(d3.easeCubicInOut)
                    .attr("x", function(d, i){
                        return xScale(i);
                    })
                    .attr("y", function(d) {
			   		    return h - yScale(d.value);
                    })
                    .attr("width", xScale.bandwidth())
                    .attr("height", function(d) {
			   		    return yScale(d.value);
                    })
                    .attr("fill", function(d) {
					    return "rgb(0, 0, " + Math.round(d.value * 10) + ")";
                    });

                bars.exit()
                    .transition()
                    .attr("x", -xScale.bandwidth())
                    .remove();
                
                // var labels = svg.selectAll("text")
                //     .data(dataset, key);

                // labels.enter()
                //     .append("text")
   			    //     .text(function(d) {
			   	// 	    return d.value;
			    //     })
			    //     .attr("text-anchor", "middle")
			    //     .attr("x", w + xScale.bandwidth() / 2)
                //     .attr("y", function(d) {
                //         if (d.value < 2) {
                //             return h - yScale(d.value) -3;
                //         } else {
                //             return h - yScale(d.value) + 14;
                //         }
                //     })
			    //     .attr("font-family", "sans-serif")
			    //     .attr("font-size", "11px")
			    //     .attr("fill", function(d, i){
                //         if (d.value < 2 ) {
                //             return "black";
                //         } else {
                //             return "white";
                //         }
                //     })
                //     .merge(labels)
                //     .transition()
                //     // .delay(function(d, i){
                //     //     return i / dataset.length * 1000;
                //     // })
                //     .duration(500)
                //     .ease(d3.easeCubicInOut)
			    //     .text(function(d) {
			   	//         return d.value;
                //     })
                //     .attr("x", function(d, i) {
			   	// 	    return xScale(i) + xScale.bandwidth() / 2;
			    //     })
			    //     .attr("y", function(d) {
                //         if (d.value < 2) {
                //             return h - yScale(d.value) -3;
                //         } else {
                //             return h - yScale(d.value) + 14;
                //         }
                //     })
                //     .attr("fill", function(d, i){
                //         if (d.value < 2 ) {
                //             return "black";
                //         } else {
                //             return "white";
                //         }
                //     });

                // labels.exit()
                //     .transition()
  				// 	.attr("x", -xScale.bandwidth())
                //     .remove();
                });
            
            var sortOrder = false;
            var sortBars = function() {
                sortOrder = !sortOrder;
                svg.selectAll("rect")
                    .sort(function(a, b) {
                        if(sortOrder) {
                            return d3.ascending(a.value, b.value);
                        } else {
                            return d3.descending(a.value, b.value);
                        }
                    })
                    .transition()
                    .delay(function(d, i) {
                        return i * 50;
                    })
                    .duration(1000)
                    .attr("x", function(d, i) {
                        return xScale(i);
                });
            };
                
		</script>
	</body>
</html>